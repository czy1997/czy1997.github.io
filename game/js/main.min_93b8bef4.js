var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(i,r){function o(t){try{c(a.next(t))}catch(e){r(e)}}function s(t){try{c(a["throw"](t))}catch(e){r(e)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}c((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return a([t,e])}}function a(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(a){n=[6,a],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseScence=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.initView,e),e}return __extends(e,t),e.prototype.initView=function(){},e}(egret.DisplayObjectContainer);__reflect(BaseScence.prototype,"BaseScence");var Point=function(){function t(t,e){this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.equal=function(t){return t&&t.x===this.x&&t.y===this.y},t.prototype.copy=function(){return new t(this.x,this.y)},t}();__reflect(Point.prototype,"Point");var OverType;!function(t){t[t.NULL=-1]="NULL",t[t.PLAYER=0]="PLAYER",t[t.CAT=1]="CAT"}(OverType||(OverType={}));var PlayScence=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initView=function(){this.sound=RES.getRes("go_mp3"),this.catRunning=!1,this.createGridNode(),this.createBarrier(n.GameData.barrierNumber),this.createCat(),this.x=(GameUtil.getStageWidth()-this.width)/2,this.y=GameUtil.getStageHeight()/2.5,SceneController.showLevelTip()},e.prototype.createGridNode=function(){n.GameData.gridNodeList=new Array(n.GameData.row);for(var t=GameUtil.getStageWidth()/(n.GameData.row+1)-n.GameData.gridMargin,e=0;e<n.GameData.row;++e){n.GameData.gridNodeList[e]=new Array(n.GameData.col);for(var a=e%2*(t/2),i=0;i<n.GameData.col;++i){var r=a+i*(t+n.GameData.gridMargin),o=e*t;n.GameData.gridNodeList[e][i]=new GridNode(new Point(e,i),new Point(r,o),t,this),n.GameData.gridNodeList[e][i].setStatus(GridNodeStatus.AVAILABLE),this.addChild(n.GameData.gridNodeList[e][i])}}},e.prototype.createBarrier=function(t){for(;t;){var e=Math.floor(100*Math.random()%n.GameData.row),a=Math.floor(100*Math.random()%n.GameData.col),i=n.GameData.gridNodeList[e][a];e!==Math.floor(n.GameData.row/2)&&a!==Math.floor(n.GameData.col/2)&&i.getStatus()===GridNodeStatus.AVAILABLE&&(i.setStatus(GridNodeStatus.UNAVAILABLE),t--)}},e.prototype.createCat=function(){var t=Math.floor(n.GameData.row/2),e=Math.floor(n.GameData.col/2);this.cat=new Cat(this),this.addChild(this.cat),this.cat.move(new Point(t,e))},e.prototype.canRun=function(){return!this.catRunning},e.prototype.playerRun=function(){this.sound.play(0,1),n.GameData.step++,this.catRunning=!0,this.cat.run()},e.prototype.catRun=function(t){t.hasPath||this.cat.setStatus(CatStatus.UNAVAILABEL);var e=t.nextStep;return e.equal(this.cat.getIndex())?void this.gameOver(OverType.PLAYER):(this.cat.move(e),e.x*e.y===0||e.x===n.GameData.row||e.y===n.GameData.col?void this.gameOver(OverType.CAT):void(this.catRunning=!1))},e.prototype.gameOver=function(t){n.GameData.overType=t,SceneController.showEndScence()},e}(BaseScence);__reflect(PlayScence.prototype,"PlayScence",["PlayListener"]);var CatStatus;!function(t){t[t.AVAILABEL=0]="AVAILABEL",t[t.UNAVAILABEL=1]="UNAVAILABEL"}(CatStatus||(CatStatus={}));var RunPath=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.step=0,e}return __extends(e,t),e.prototype.copy=function(){var t=new e(this.x,this.y);return t.step=this.step,t.firstStep=this.firstStep.copy(),t},e}(Point);__reflect(RunPath.prototype,"RunPath");var SearchResult=function(){function t(){this.hasPath=!0}return t}();__reflect(SearchResult.prototype,"SearchResult");var Cat=function(t){function e(e){var n=t.call(this)||this;return n.catMovieClip={normal:GameUtil.createMovieClipByName("cat_normal"),loser:GameUtil.createMovieClipByName("cat_loser")},n.playListener=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(e,t),e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.bg=new egret.MovieClip,this.addChild(this.bg),this.setStatus(CatStatus.AVAILABEL)},e.prototype.setStatus=function(t){this.status!=t&&(this.status=t,this.changeBg())},e.prototype.changeBg=function(){switch(this.status){case CatStatus.AVAILABEL:this.bg.movieClipData=this.catMovieClip.normal.movieClipData,this.bg.play(-1);break;case CatStatus.UNAVAILABEL:this.bg.movieClipData=this.catMovieClip.loser.movieClipData,this.bg.play(-1)}},e.prototype.move=function(t){void 0===t&&(t=this.index),t.equal(this.index)||(this.gridNode&&this.gridNode.setStatus(GridNodeStatus.AVAILABLE),this.gridNode=n.GameData.gridNodeList[t.x][t.y],this.index=t,this.x=this.gridNode.x+(this.gridNode.width-this.bg.width)/2,this.y=this.gridNode.y-this.bg.height+this.gridNode.height)},e.prototype.getIndex=function(){return this.index},e.prototype.run=function(){this.playListener&&this.playListener.catRun(this.search())},e.prototype.search=function(){for(var t=new Array(n.GameData.row),e=0;e<n.GameData.row;++e){t[e]=new Array(n.GameData.col);for(var a=0;a<n.GameData.col;++a)t[e][a]=Number.MAX_VALUE}var i=this.getFirstStep(),r=new Array;console.log(i),i.forEach(function(e){t[e.x][e.y]=1,r.push(e.copy())});for(var o=Number.MAX_VALUE,s=new Array;r.length;){var c=r.shift();if(0!==c.x&&0!==c.y&&c.x!==n.GameData.row&&c.y!==n.GameData.col)for(var h=this.getDir(c.x),e=0;e<h.length;++e){var l=new RunPath(c.x,c.y);l.x+=h[e][0],l.y+=h[e][0],l.step=c.step+1,0!==l.x&&0!==l.y&&l.x!==n.GameData.row&&l.y!==n.GameData.col&&n.GameData.gridNodeList[l.x][l.y].getStatus()===GridNodeStatus.AVAILABLE&&t[l.x][l.y]>l.step&&(t[l.x][l.y]=l.step,l.firstStep=c.firstStep.copy(),r.push(l))}else c.step<o?(s=new Array,s.push(c.firstStep.copy()),o=c.step):c.step===o&&s.push(c.firstStep.copy())}var u=new SearchResult;if(o===Number.MAX_VALUE&&(this.setStatus(CatStatus.UNAVAILABEL),u.hasPath=!1),0===s.length&&i.forEach(function(t){s.push(t.firstStep)}),s.length>0){var d=this.sortList(s),p=Math.floor(Math.random()*d.length);u.nextStep=d[p]}else u.nextStep=this.index;return u},e.prototype.sortList=function(t){var e=new Array;t.forEach(function(t){for(var n=t.x+"-"+t.y,a=-1,i=0;i<e.length;++i)if(e[i].key===n){a=i;break}a>-1?e[a].count++:e.push({key:n,value:t,count:1})}),e.sort(function(t,e){return e.count-t.count});var n=new Array;return e.forEach(function(t){t.count===e[0].count&&n.push(new Point(t.value.x,t.value.y))}),n},e.prototype.getFirstStep=function(){for(var t=new Array,e=this.getDir(this.index.x),a=0;a<e.length;a++){console.log(a);var i=this.index.x+e[a][0],r=this.index.y+e[a][1];if(console.log(i,r),!(0>i||0>r||i>=n.GameData.row||r>=n.GameData.col)&&n.GameData.gridNodeList[i][r].getStatus()===GridNodeStatus.AVAILABLE){var o=new RunPath(i,r);o.step=1,o.firstStep=new Point(i,r),t.push(o)}}return t},e.prototype.getDir=function(t){var e=t%2,n=[[0,-1],[0,1],[-1,e-1],[-1,1*e],[1,e-1],[1,1*e]];return n},e}(egret.Sprite);__reflect(Cat.prototype,"Cat");var n;!function(t){var e=function(){function t(){}return t.level=0,t.levelData=[{barrierNumber:10,row:7,col:7},{barrierNumber:22,row:8,col:8},{barrierNumber:24,row:9,col:9},{barrierNumber:26,row:10,col:10},{barrierNumber:24,row:10,col:10},{barrierNumber:22,row:10,col:10},{barrierNumber:20,row:10,col:10},{barrierNumber:18,row:10,col:10},{barrierNumber:16,row:10,col:10},{barrierNumber:14,row:10,col:10}],t.overType=OverType.NULL,t.step=0,t.barrierNumber=15,t.row=6,t.col=6,t.gridMargin=10,t}();t.GameData=e,__reflect(e.prototype,"n.GameData")}(n||(n={}));var SceneController=function(){function t(){this.startScence=new StartScence,this.playScence=new PlayScence,this.endScence=new EndScence}return Object.defineProperty(t,"instance",{get:function(){return this.SceneController||(this.SceneController=new t),this.SceneController},enumerable:!0,configurable:!0}),t.prototype.setStage=function(t){this._stage=t},t.initGame=function(){var t=this.instance._stage;this.instance.startScence.parent&&(t.removeChild(this.instance.startScence),this.instance.startScence=new StartScence),this.instance.endScence.parent&&(t.removeChild(this.instance.endScence),this.instance.endScence=new EndScence),this.instance.playScence.parent&&(t.removeChild(this.instance.playScence),this.instance.playScence=new PlayScence),t.addChild(this.instance.startScence)},t.showPlayScene=function(){var t=this.instance._stage;this.instance.startScence.parent&&(t.removeChild(this.instance.startScence),this.instance.startScence=new StartScence),this.instance.endScence.parent&&(t.removeChild(this.instance.endScence),this.instance.endScence=new EndScence),this.instance.playScence.parent&&(t.removeChild(this.instance.playScence),this.instance.playScence=new PlayScence);var e=n.GameData.level;e>=n.GameData.levelData.length&&(e=n.GameData.levelData.length-1),n.GameData.barrierNumber=n.GameData.levelData[e].barrierNumber,n.GameData.row=n.GameData.levelData[e].row,n.GameData.col=n.GameData.levelData[e].col,n.GameData.step=0,n.GameData.overType=OverType.NULL,t.addChild(this.instance.playScence)},t.showEndScence=function(){var t=this.instance._stage;t.addChild(this.instance.endScence)},t.showLevelTip=function(){var t=n.GameData.level+1,e=this.instance._stage,a=new egret.DisplayObjectContainer;a.width=GameUtil.getStageWidth(),a.height=GameUtil.getStageHeight(),a.x=0,a.y=0,e.addChild(a);var i=new egret.Shape;i.graphics.beginFill(0,.8),i.graphics.drawRect(0,0,GameUtil.getStageWidth(),GameUtil.getStageHeight()),i.graphics.endFill(),i.touchEnabled=!0,e.addChild(i);var r=new egret.TextField;r.bold=!0,r.textColor=16777215,r.stroke=2,r.strokeColor=0,r.size=60,r.text="第"+t+"关",r.x=(a.width-r.width)/2+a.x,r.y=(a.height-r.height)/2,e.addChild(r),egret.Tween.get(r).wait(500).to({y:10,alpha:0},1e3,egret.Ease.backInOut).call(function(){e.removeChild(a)}),egret.Tween.get(i).wait(500).to({alpha:0},100,egret.Ease.sineIn).call(function(){e.removeChild(i),e.removeChild(r)})},t}();__reflect(SceneController.prototype,"SceneController");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=new egret.DisplayObjectContainer;this.addChild(t);var e=GameUtil.createBitmapByName("bg","jpg");t.addChild(e);var n=GameUtil.getStageWidth()/e.width,a=GameUtil.getStageHeight()/e.height,i=e.width/e.height;n>a?(e.width=GameUtil.getStageWidth(),e.width=e.width/i):(e.height=GameUtil.getStageHeight(),e.width=e.height*i),e.x=(GameUtil.getStageWidth()-e.width)/2,SceneController.instance.setStage(t),SceneController.initGame()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var GridNodeStatus;!function(t){t[t.AVAILABLE=0]="AVAILABLE",t[t.UNAVAILABLE=1]="UNAVAILABLE",t[t.CAT=2]="CAT"}(GridNodeStatus||(GridNodeStatus={}));var GridNode=function(t){function e(e,n,a,i){var r=t.call(this)||this;return r.gridBg={white:GameUtil.createBitmapByName("grid_white"),yellow:GameUtil.createBitmapByName("grid_yellow")},r.bg=new egret.Bitmap,r.index=e,r.size=a,r.bg.width=a,r.bg.height=a,r.pos=n,r.playListener=i,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r),r}return __extends(e,t),e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touch,this),this.x=this.pos.x,this.y=this.pos.y,this.addChild(this.bg)},e.prototype.setStatus=function(t){this.status=t,this.changeBg()},e.prototype.getStatus=function(){return this.status},e.prototype.changeBg=function(){switch(this.status){case GridNodeStatus.AVAILABLE:this.bg.texture=this.gridBg.white.texture;break;case GridNodeStatus.UNAVAILABLE:this.bg.texture=this.gridBg.yellow.texture;break;case GridNodeStatus.CAT:this.bg.texture=this.gridBg.white.texture}},e.prototype.touch=function(){this.playListener&&this.playListener.canRun()&&this.status===GridNodeStatus.AVAILABLE&&(this.setStatus(GridNodeStatus.UNAVAILABLE),this.playListener.playerRun(this.index))},e}(egret.Sprite);__reflect(GridNode.prototype,"GridNode");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var EndScence=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Shape;switch(t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,GameUtil.getStageWidth(),GameUtil.getStageHeight()),t.graphics.endFill(),t.touchEnabled=!0,this.addChild(t),n.GameData.overType){case OverType.PLAYER:this.initPlayerWin();break;case OverType.CAT:this.initCatWin()}},e.prototype.initPlayerWin=function(){var t=GameUtil.createBitmapByName("end_tip_success");this.addChild(t),t.x=(GameUtil.getStageWidth()-t.width)/2,t.y=(GameUtil.getStageHeight()-t.height)/2;var e=new egret.TextField;e.bold=!0,e.textColor=16777215,e.stroke=2,e.strokeColor=0,e.text="您花了"+n.GameData.step+"步抓住了神经猫",e.x=(t.width-e.width)/2+t.x,e.y=(t.height-e.height)/2+t.y+50,this.addChild(e);var a=RES.getRes("success_mp3");a.play(0,1);var i=GameUtil.createBitmapByName("btn_next");this.addChild(i),i.x=(GameUtil.getStageWidth()-i.width)/2,i.y=t.y+t.height,GameUtil.bitmapToBtn(i,function(){n.GameData.level++,SceneController.showPlayScene()})},e.prototype.initCatWin=function(){var t=GameUtil.createBitmapByName("end_tip_fail");this.addChild(t),t.x=(GameUtil.getStageWidth()-t.width)/2,t.y=(GameUtil.getStageHeight()-t.height)/2;var e=new egret.TextField;e.bold=!0,e.textColor=16777215,e.stroke=2,e.strokeColor=0,e.text="您坚持"+n.GameData.level+"关\n还是让神经猫跑了",e.x=(t.width-e.width)/2+t.x,e.y=(t.height-e.height)/2+t.y+50,this.addChild(e);var a=RES.getRes("fail_mp3");a.play(0,1);var i=GameUtil.createBitmapByName("btn_back");this.addChild(i),i.x=(GameUtil.getStageWidth()-i.width)/2-i.width/2,i.y=t.y+t.height,GameUtil.bitmapToBtn(i,function(){n.GameData.level=0,SceneController.initGame()});var r=GameUtil.createBitmapByName("btn_replay");this.addChild(r),r.x=(GameUtil.getStageWidth()-r.width)/2+r.width/2,r.y=t.y+t.height,GameUtil.bitmapToBtn(r,function(){n.GameData.level=0,SceneController.showPlayScene()})},e}(BaseScence);__reflect(EndScence.prototype,"EndScence");var GameUtil=function(){function t(){}return t.getStageHeight=function(){return egret.MainContext.instance.stage.height},t.getStageWidth=function(){return egret.MainContext.instance.stage.width},t.createBitmapByName=function(t,e){void 0===e&&(e="png");var n=new egret.Bitmap,a=RES.getRes(t+"_"+e);return n.texture=a,n},t.createMovieClipByName=function(t){var e=RES.getRes(t+"_json"),n=RES.getRes(t+"_png"),a=new egret.MovieClipDataFactory(e,n);return new egret.MovieClip(a.generateMovieClipData(t))},t.bitmapToBtn=function(t,e){function n(){t.anchorOffsetX=0,t.anchorOffsetY=0,t.x=a.x,t.y=a.y,t.scaleX=1,t.scaleY=1}t.touchEnabled=!0;var a=new Point(t.x,t.y);t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=a.x+t.width/2,t.y=a.y+t.height/2,t.scaleX=.95,t.scaleY=.95},this),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n(),e&&e()},this),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,n,this),t.addEventListener(egret.TouchEvent.TOUCH_END,n,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,n,this)},t}();__reflect(GameUtil.prototype,"GameUtil");var StartScence=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initView=function(){var t=GameUtil.createBitmapByName("cat_start_bg");this.addChild(t),t.x=(GameUtil.getStageWidth()-t.width)/2,t.y=(GameUtil.getStageHeight()-t.height)/2+100;var e=GameUtil.createBitmapByName("btn_start");this.addChild(e),e.x=(GameUtil.getStageWidth()-e.width)/2,e.y=t.y+t.height,GameUtil.bitmapToBtn(e,function(){SceneController.showPlayScene()})},e}(BaseScence);__reflect(StartScence.prototype,"StartScence");